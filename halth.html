<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>운동 관리 프로그램</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#e0e0e0;
  --panel:#6b7a94;
  --group:#8a99b3;
  --btn:#5a6b85;
  --accent:#fbbf24;
  --muted:#e3f2fd;
  --save:#10b981;
  --danger:#ef4444;
}
*{box-sizing:border-box}
body { font-family: 'Malgun Gothic','Noto Sans KR',sans-serif; background:var(--bg); margin:0; padding:20px;}
.container { max-width:920px; margin:0 auto; background:var(--panel); border-radius:30px; padding:36px; box-shadow:0 20px 60px rgba(0,0,0,0.25);}
h1{ color:#fff; text-align:center; margin:0 0 6px; font-size:2rem;}
.subtitle{ color:#fff; text-align:center; margin:0 0 24px; font-size:1.05rem; opacity:0.95;}
h3{ font-size:1.15rem; color:#fff; margin:0 0 12px;}
.exercise-group{ background:var(--group); border-radius:16px; padding:18px; margin-bottom:18px; box-shadow: inset 0 -8px 18px rgba(0,0,0,0.06);}
.btn-row{ display:flex; flex-wrap:wrap; gap:8px;}
.exercise-btn{ padding:10px 14px; margin:0; background:var(--btn); color:var(--muted); border:none; border-radius:10px; cursor:pointer; font-size:1rem; transition:all .16s; box-shadow:0 6px 14px rgba(0,0,0,0.12);}
.exercise-btn:active{ transform:translateY(1px);}
.exercise-btn.active{ background:var(--accent); color:#000; font-weight:700; box-shadow:0 8px 18px rgba(0,0,0,0.18);}
.note-section{ margin-top:6px; margin-bottom:18px;}
.note-section label{ font-size:1.05rem; color:#fff; display:block; margin-bottom:8px;}
.note-section textarea{ width:100%; min-height:96px; border-radius:10px; padding:12px; border:none; font-size:1rem; font-family: inherit; resize:vertical;}
.score-card{ background:var(--btn); color:#fff; text-align:center; padding:20px; border-radius:14px; margin:18px 0; font-size:1.4rem; font-weight:700;}
.score-card small{ display:block; font-size:0.85rem; font-weight:400; opacity:0.9; margin-top:6px;}
.save-btn, .backup-btn, .restore-btn{ width:100%; padding:14px 18px; border:none; border-radius:10px; cursor:pointer; font-size:1.05rem; font-weight:700; margin-bottom:6px;}
.save-btn{ background:var(--save); color:#fff; box-shadow:0 10px 24px rgba(16,185,129,0.18);}
.backup-btn{ background:#3b82f6; color:#fff; box-shadow:0 10px 24px rgba(59,130,246,0.18);}
.restore-btn{ background:#6366f1; color:#fff; box-shadow:0 10px 24px rgba(99,102,241,0.18);}
.record-list{ background:var(--group); border-radius:12px; padding:10px; max-height:340px; overflow-y:auto; margin-top:10px;}
.record-item{ display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid rgba(255,255,255,0.12); font-size:0.98rem; color:#fff; gap:12px;}
.record-item:last-child{ border-bottom:none;}
.delete-btn{ background:var(--danger); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-size:0.95rem;}
.empty-state{ text-align:center; color:#fff; font-size:1rem; padding:24px; opacity:0.95;}
canvas{ width:100% !important; height:280px !important; display:block; margin-top:18px; border-radius:12px; padding:8px; box-shadow: inset 0 -8px 12px rgba(0,0,0,0.06);}
@media (max-width:600px){.container{padding:18px;border-radius:18px;}h1{font-size:1.5rem;}.score-card{font-size:1.2rem;}}
</style>
</head>
<body>
<div class="container">
<h1>🏆 운동 관리 프로그램</h1>
<p class="subtitle">건강한 습관, 더 나은 내일 — 세트 선택 후 저장하세요</p>

<div class="exercise-group">
<h3>팔굽혀펴기 (5세트 / 20점)</h3><div id="pushupButtons" class="btn-row"></div>
</div>
<div class="exercise-group">
<h3>윗몸일으키기 (5세트 / 24점)</h3><div id="situpButtons" class="btn-row"></div>
</div>
<div class="exercise-group">
<h3>스쿼트 (5세트 / 25점)</h3><div id="squatButtons" class="btn-row"></div>
</div>
<div class="exercise-group">
<h3>걷기 (1세트 / 31점)</h3><div id="walkButtons" class="btn-row"></div>
</div>

<div class="note-section">
<label>📝 운동 메모</label>
<textarea id="note" placeholder="오늘 운동에 대한 메모 (선택)"></textarea>
</div>

<div class="score-card">
오늘 점수: <span id="scoreDisplay">0점</span>
<small id="scoreHint">세트를 선택하면 점수가 실시간 반영됩니다.</small>
</div>

<button class="save-btn" id="saveBtn">저장</button>
<button class="backup-btn" id="backupBtn">💾 기록 백업</button>
<input type="file" id="restoreInput" accept=".json" style="display:none"/>
<button class="restore-btn" id="restoreBtn">📂 백업 불러오기</button>

<h3 style="margin-top:22px; font-size:1.05rem; color:#fff;">📋 기록</h3>
<div class="record-list" id="recordList">
<div class="empty-state">아직 기록이 없습니다 💪</div>
</div>

<canvas id="scoreChart" aria-label="점수 그래프" role="img"></canvas>
</div>

<script>
const exerciseApp = {
records:[], chart:null, storageKey:'exerciseRecords_v1',

init() {
  this.loadData();
  this.createButtons();
  this.attachEventListeners();
  this.updateScore();
  this.updateRecordList();
  this.updateChart();
},

loadData() {
  try{
    const saved = localStorage.getItem(this.storageKey);
    if(saved) this.records = JSON.parse(saved);
  }catch(e){ this.records=[]; }
},

saveData(){ localStorage.setItem(this.storageKey, JSON.stringify(this.records)); },

createButtons(){
  this.createExerciseButtons('pushupButtons',5);
  this.createExerciseButtons('situpButtons',5);
  this.createExerciseButtons('squatButtons',5);
  this.createExerciseButtons('walkButtons',1);
},

createExerciseButtons(id,count){
  const container=document.getElementById(id);
  container.innerHTML='';
  for(let i=1;i<=count;i++){
    const btn=document.createElement('button');
    btn.className='exercise-btn';
    btn.type='button';
    btn.textContent=i+'세트';
    btn.addEventListener('click',()=>{ btn.classList.toggle('active'); this.updateScore(); });
    container.appendChild(btn);
  }
},

calculateScore(){
  const pushup=document.querySelectorAll('#pushupButtons .active').length;
  const situp=document.querySelectorAll('#situpButtons .active').length;
  const squat=document.querySelectorAll('#squatButtons .active').length;
  const walk=document.querySelectorAll('#walkButtons .active').length;
  return Math.round((pushup/5)*20 + (situp/5)*24 + (squat/5)*25 + (walk/1)*31);
},

updateScore(){ document.getElementById('scoreDisplay').textContent=this.calculateScore()+'점'; },

saveRecord(){
  const score=this.calculateScore();
  if(score===0){ this.showHint('1세트 이상 선택하세요'); return; }
  const note=document.getElementById('note').value.trim();
  const now=new Date();
  this.records.push({ id:Date.now(), date:now.toLocaleDateString(), time:now.toLocaleTimeString(), score, note, timestamp:now.getTime() });
  this.saveData();
  document.querySelectorAll('.exercise-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('note').value='';
  this.updateScore(); this.updateRecordList(); this.updateChart();
  this.showHint('저장되었습니다! 💪');
},

deleteRecord(id){
  this.records=this.records.filter(r=>r.id!==id);
  this.saveData();
  this.updateRecordList(); this.updateChart();
  this.showHint('기록이 삭제되었습니다.');
},

updateRecordList(){
  const list=document.getElementById('recordList');
  if(!this.records.length){ list.innerHTML='<div class="empty-state">아직 기록이 없습니다 💪</div>'; document.getElementById('scoreDisplay').textContent='0점'; if(this.chart) this.chart.destroy(); return; }
  const sorted=this.records.slice().sort((a,b)=>b.timestamp-b.timestamp);
  list.innerHTML='';
  sorted.forEach(r=>{
    const item=document.createElement('div'); item.className='record-item';
    const left=document.createElement('div'); left.style.flex='1';
    left.innerHTML=`<strong style="display:block">${r.date} ${r.time}</strong>${r.note?`<div style="margin-top:6px;opacity:0.95">📝 ${this.escapeHtml(r.note)}</div>`:''}`;
    const right=document.createElement('div'); right.style.display='flex'; right.style.alignItems='center'; right.style.gap='10px';
    right.innerHTML=`<strong>${r.score}점</strong>`;
    const del=document.createElement('button'); del.className='delete-btn'; del.type='button'; del.textContent='삭제';
    del.addEventListener('click',()=>this.deleteRecord(r.id));
    right.appendChild(del); item.appendChild(left); item.appendChild(right); list.appendChild(item);
  });
},

updateChart(){
  const ctx=document.getElementById('scoreChart').getContext('2d');
  if(!this.records.length){ if(this.chart){this.chart.destroy(); this.chart=null;} ctx.clearRect(0,0,ctx.canvas.width,ctx.canvas.height); return; }
  const sorted=this.records.slice().sort((a,b)=>a.timestamp-b.timestamp);
  const labels=sorted.map(r=>`${r.date}\n${r.time}`);
  const data=sorted.map(r=>r.score);
  if(this.chart) this.chart.destroy();
  this.chart=new Chart(ctx,{ type:'line', data:{labels,datasets:[{label:'점수',data,borderColor:'#fbbf24',backgroundColor:'rgba(251,191,36,0.18)',fill:true,borderWidth:3,pointRadius:5,tension:0.25}]}, options:{maintainAspectRatio:false,plugins:{legend:{labels:{font:{size:12}}},tooltip:{mode:'index',intersect:false}}, scales:{x:{ticks:{font:{size:11},maxRotation:30,minRotation:0},grid:{display:false}}, y:{beginAtZero:true,ticks:{font:{size:12}}}}}});
},

attachEventListeners(){
  document.getElementById('saveBtn').addEventListener('click',()=>this.saveRecord());
  document.getElementById('note').addEventListener('keydown',e=>{ if(e.ctrlKey&&e.key==='Enter'){e.preventDefault(); this.saveRecord();}});
  document.getElementById('backupBtn').addEventListener('click',()=>this.backupRecords());
  document.getElementById('restoreBtn').addEventListener('click',()=>document.getElementById('restoreInput').click());
  document.getElementById('restoreInput').addEventListener('change',e=>this.restoreRecords(e));
},

showHint(msg,duration=1400){ const s=document.querySelector('.subtitle'); const orig=s.textContent; s.textContent=msg; clearTimeout(this._hintTimer); this._hintTimer=setTimeout(()=>{s.textContent=orig;},duration); },

backupRecords(){
  if(!this.records.length){ this.showHint('저장된 기록이 없습니다'); return; }
  const blob=new Blob([JSON.stringify(this.records)],{type:'application/json'});
  const url=URL.createObjectURL(blob);
  const a=document.createElement('a'); a.href=url; a.download='exercise_records_backup.json'; a.click();
  URL.revokeObjectURL(url);
},

restoreRecords(e){
  const file=e.target.files[0]; if(!file)return;
  const reader=new FileReader();
  reader.onload=()=>{ try{ const data=JSON.parse(reader.result); if(Array.isArray(data)){ this.records=data; this.saveData(); this.updateRecordList(); this.updateChart(); this.showHint('백업 복원 완료!'); }else{ this.showHint('파일 형식 오류'); } }catch(err){ this.showHint('읽기 실패'); } };
  reader.readAsText(file); e.target.value='';
},

escapeHtml(str){ return str.replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
};

document.addEventListener('DOMContentLoaded',()=>exerciseApp.init());
</script>
</body>
</html>
