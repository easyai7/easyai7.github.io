<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ìš´ë™ ê´€ë¦¬ í”„ë¡œê·¸ë¨</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{
  --bg:#e0e0e0;
  --panel:#6b7a94;
  --group:#8a99b3;
  --btn:#5a6b85;
  --accent:#fbbf24;
  --muted:#e3f2fd;
  --save:#10b981;
  --danger:#ef4444;
  --today:#4ade80;
}
*{box-sizing:border-box}
body { font-family: 'Malgun Gothic','Noto Sans KR',sans-serif; background:var(--bg); margin:0; padding:20px;}
.container { max-width:920px; margin:0 auto; background:var(--panel); border-radius:30px; padding:36px; box-shadow:0 20px 60px rgba(0,0,0,0.25);}
h1{ color:#fff; text-align:center; margin:0 0 6px; font-size:2rem;}
.subtitle{ color:#fff; text-align:center; margin:0 0 24px; font-size:1.05rem; opacity:0.95;}
h3{ font-size:1.15rem; color:#fff; margin:0 0 12px;}

.today-status {
  background: var(--today);
  color: #000;
  padding: 15px;
  border-radius: 12px;
  margin-bottom: 20px;
  text-align: center;
  font-weight: bold;
  font-size: 1.1rem;
}

.exercise-group{ background:var(--group); border-radius:16px; padding:18px; margin-bottom:18px; box-shadow: inset 0 -8px 18px rgba(0,0,0,0.06); position:relative;}
.completed-badge{ position:absolute; top:10px; right:10px; background:var(--today); color:#000; padding:4px 10px; border-radius:20px; font-size:0.85rem; font-weight:bold;}
.btn-row{ display:flex; flex-wrap:wrap; gap:8px;}
.exercise-btn{ padding:10px 14px; margin:0; background:var(--btn); color:var(--muted); border:none; border-radius:10px; cursor:pointer; font-size:1rem; transition:all .16s; box-shadow:0 6px 14px rgba(0,0,0,0.12);}
.exercise-btn:active{ transform:translateY(1px);}
.exercise-btn.active{ background:var(--accent); color:#000; font-weight:700; box-shadow:0 8px 18px rgba(0,0,0,0.18);}
.exercise-btn.completed{ background:#86efac; color:#000; font-weight:700;}

.note-section{ margin-top:6px; margin-bottom:18px;}
.note-section label{ font-size:1.05rem; color:#fff; display:block; margin-bottom:8px;}
.note-section textarea{ width:100%; min-height:96px; border-radius:10px; padding:12px; border:none; font-size:1rem; font-family: inherit; resize:vertical;}

.score-card{ background:var(--btn); color:#fff; text-align:center; padding:20px; border-radius:14px; margin:18px 0; font-size:1.4rem; font-weight:700;}
.score-card small{ display:block; font-size:0.85rem; font-weight:400; opacity:0.9; margin-top:6px;}
.score-progress { display:flex; justify-content:space-around; margin-top:10px; font-size:0.9rem; }

.save-btn, .reset-btn, .backup-btn, .restore-btn{ width:100%; padding:14px 18px; border:none; border-radius:10px; cursor:pointer; font-size:1.05rem; font-weight:700; margin-bottom:6px;}
.save-btn{ background:var(--save); color:#fff; box-shadow:0 10px 24px rgba(16,185,129,0.18);}
.reset-btn{ background:#f59e0b; color:#fff; box-shadow:0 10px 24px rgba(245,158,11,0.18);}
.backup-btn{ background:#3b82f6; color:#fff; box-shadow:0 10px 24px rgba(59,130,246,0.18);}
.restore-btn{ background:#6366f1; color:#fff; box-shadow:0 10px 24px rgba(99,102,241,0.18);}

.record-list{ background:var(--group); border-radius:12px; padding:10px; max-height:340px; overflow-y:auto; margin-top:10px;}
.record-item{ display:flex; justify-content:space-between; align-items:center; padding:12px; border-bottom:1px solid rgba(255,255,255,0.12); font-size:0.98rem; color:#fff; gap:12px;}
.record-item.today { background:rgba(74,222,128,0.2); border-radius:8px; margin-bottom:5px;}
.record-item:last-child{ border-bottom:none;}
.delete-btn{ background:var(--danger); color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-size:0.95rem;}
.edit-btn{ background:#f59e0b; color:#fff; border:none; padding:8px 12px; border-radius:8px; cursor:pointer; font-size:0.95rem; margin-right:5px;}

.empty-state{ text-align:center; color:#fff; font-size:1rem; padding:24px; opacity:0.95;}
.stats-info{ background:rgba(255,255,255,0.1); border-radius:10px; padding:12px; margin:10px 0; color:#fff; font-size:0.9rem; text-align:center;}
canvas{ width:100% !important; height:280px !important; display:block; margin-top:18px; border-radius:12px; padding:8px; box-shadow: inset 0 -8px 12px rgba(0,0,0,0.06);}

.storage-warning {
  background: #fbbf24;
  color: #000;
  padding: 10px;
  border-radius: 8px;
  margin: 10px 0;
  font-size: 0.9rem;
  display: none;
}

@media (max-width:600px){.container{padding:18px;border-radius:18px;}h1{font-size:1.5rem;}.score-card{font-size:1.2rem;}}
</style>
</head>
<body>
<div class="container">
<h1>ğŸ† ìš´ë™ ê´€ë¦¬ í”„ë¡œê·¸ë¨</h1>
<p class="subtitle">ì²´í¬í•˜ëŠ” ì¦‰ì‹œ ìë™ ì €ì¥ | í‹ˆí‹ˆì´ ìš´ë™ ëˆ„ì  ê¸°ë¡</p>

<div class="today-status" id="todayStatus">
  ì˜¤ëŠ˜ ë‚ ì§œ í™•ì¸ ì¤‘...
</div>

<div class="storage-warning" id="storageWarning">
  âš ï¸ ë°ì´í„° ì €ì¥ ì‹¤íŒ¨ - Chrome ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”
</div>

<div class="exercise-group" id="pushupGroup">
<h3>íŒ”êµ½í˜€í´ê¸° (5ì„¸íŠ¸ / 20ì )</h3>
<div id="pushupButtons" class="btn-row"></div>
</div>

<div class="exercise-group" id="situpGroup">
<h3>ìœ—ëª¸ì¼ìœ¼í‚¤ê¸° (5ì„¸íŠ¸ / 24ì )</h3>
<div id="situpButtons" class="btn-row"></div>
</div>

<div class="exercise-group" id="squatGroup">
<h3>ìŠ¤ì¿¼íŠ¸ (5ì„¸íŠ¸ / 25ì )</h3>
<div id="squatButtons" class="btn-row"></div>
</div>

<div class="exercise-group" id="walkGroup">
<h3>ê±·ê¸° (1ì„¸íŠ¸ / 31ì )</h3>
<div id="walkButtons" class="btn-row"></div>
</div>

<div class="note-section">
<label>ğŸ“ ì˜¤ëŠ˜ ìš´ë™ ë©”ëª¨</label>
<textarea id="note" placeholder="ì˜¤ëŠ˜ ìš´ë™ì— ëŒ€í•œ ë©”ëª¨ (ì„ íƒ)"></textarea>
</div>

<div class="score-card">
í˜„ì¬ ëˆ„ì  ì ìˆ˜: <span id="scoreDisplay">0ì </span>
<div class="score-progress">
  <span>íŒ”: <span id="pushupScore">0</span></span>
  <span>ìœ—ëª¸: <span id="situpScore">0</span></span>
  <span>ìŠ¤ì¿¼íŠ¸: <span id="squatScore">0</span></span>
  <span>ê±·ê¸°: <span id="walkScore">0</span></span>
</div>
<small id="scoreHint">ì²´í¬ë§Œ í•´ë„ ìë™ ì €ì¥ | ëˆ„ì  ì €ì¥ìœ¼ë¡œ ê¸°ë¡ í™•ì • | ì´ˆê¸°í™”ëŠ” ì²´í¬ë§Œ í•´ì œ</small>
</div>

<button class="save-btn" id="saveBtn">âœ… ëˆ„ì  ì €ì¥ (ì˜¤ëŠ˜ ìš´ë™ ì—…ë°ì´íŠ¸)</button>
<button class="reset-btn" id="resetBtn">ğŸ”„ ì²´í¬ ì´ˆê¸°í™” (ê¸°ë¡ì€ ìœ ì§€)</button>
<button class="backup-btn" id="backupBtn">ğŸ’¾ ì „ì²´ ê¸°ë¡ ë°±ì—…</button>
<input type="file" id="restoreInput" accept=".json" style="display:none"/>
<button class="restore-btn" id="restoreBtn">ğŸ“‚ ë°±ì—… ë¶ˆëŸ¬ì˜¤ê¸°</button>

<div class="stats-info" id="statsInfo"></div>

<h3 style="margin-top:22px; font-size:1.05rem; color:#fff;">ğŸ“‹ ìš´ë™ ê¸°ë¡</h3>
<div class="record-list" id="recordList">
<div class="empty-state">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ’ª</div>
</div>

<canvas id="scoreChart" aria-label="ì ìˆ˜ ê·¸ë˜í”„" role="img"></canvas>
</div>

<script>
const exerciseApp = {
  records: [], 
  todayData: null,
  chart: null, 
  storageKey: 'exerciseRecords_v3',
  todayKey: '',

  init() {
    console.log('ì•± ì´ˆê¸°í™” ì‹œì‘');
    this.testStorage();
    this.setTodayKey();
    this.loadData();
    this.createButtons();
    this.loadTempState(); // ì„ì‹œ ì €ì¥ ìƒíƒœ ë³µì›
    this.attachEventListeners();
    this.loadTodayData();
    this.updateAllUI();
  },

  testStorage() {
    try {
      localStorage.setItem('test', '1');
      localStorage.removeItem('test');
      console.log('âœ… localStorage ì •ìƒ ì‘ë™');
    } catch(e) {
      console.error('âŒ localStorage ì˜¤ë¥˜:', e);
      document.getElementById('storageWarning').style.display = 'block';
      document.getElementById('storageWarning').innerHTML = `
        âš ï¸ Chrome ì„¤ì • í™•ì¸ í•„ìš”:<br>
        1. Chrome ì„¤ì • > ì‚¬ì´íŠ¸ ì„¤ì • > ì¿ í‚¤<br>
        2. "ëª¨ë“  ì¿ í‚¤ í—ˆìš©" ì„ íƒ<br>
        3. ì‹œí¬ë¦¿ ëª¨ë“œê°€ ì•„ë‹Œì§€ í™•ì¸
      `;
    }
  },

  setTodayKey() {
    const today = new Date();
    this.todayKey = `${today.getFullYear()}-${String(today.getMonth()+1).padStart(2,'0')}-${String(today.getDate()).padStart(2,'0')}`;
    const todayDisplay = today.toLocaleDateString('ko-KR', {month:'long', day:'numeric', weekday:'long'});
    document.getElementById('todayStatus').textContent = `ğŸ“… ì˜¤ëŠ˜: ${todayDisplay}`;
  },

  loadData() {
    try {
      const saved = localStorage.getItem(this.storageKey);
      if(saved) {
        this.records = JSON.parse(saved);
        console.log(`âœ… ${this.records.length}ê°œ ê¸°ë¡ ë¶ˆëŸ¬ì˜´`);
      }
    } catch(e) { 
      console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
      this.records = []; 
    }
  },

  saveData() { 
    try {
      localStorage.setItem(this.storageKey, JSON.stringify(this.records));
      console.log(`âœ… ì €ì¥ ì™„ë£Œ (ì´ ${this.records.length}ê°œ ê¸°ë¡)`);
      return true;
    } catch(e) {
      console.error('âŒ ì €ì¥ ì‹¤íŒ¨:', e);
      document.getElementById('storageWarning').style.display = 'block';
      return false;
    }
  },

  loadTodayData() {
    // ì˜¤ëŠ˜ ë‚ ì§œì˜ ê¸°ë¡ ì°¾ê¸°
    this.todayData = this.records.find(r => r.dateKey === this.todayKey);
    
    if(this.todayData) {
      console.log('ì˜¤ëŠ˜ ì €ì¥ëœ ê¸°ë¡ ìˆìŒ:', this.todayData);
      // ì˜¤ëŠ˜ ì´ë¯¸ ì €ì¥í•œ ìš´ë™ í‘œì‹œ (completedë¡œë§Œ í‘œì‹œ)
      this.showSavedExercises();
    } else {
      console.log('ì˜¤ëŠ˜ ì €ì¥ëœ ê¸°ë¡ ì—†ìŒ - ìƒˆë¡œ ì‹œì‘');
    }
  },

  showSavedExercises() {
    if(!this.todayData) return;
    
    // ì €ì¥ëœ ìš´ë™ì„ completedë¡œë§Œ í‘œì‹œ (active ì—†ì´)
    const exercises = this.todayData.exercises || {};
    
    // ê° ìš´ë™ë³„ë¡œ ì €ì¥ëœ ê°œìˆ˜ë§Œí¼ í‘œì‹œ
    const groups = [
      { id: 'pushupGroup', count: exercises.pushup },
      { id: 'situpGroup', count: exercises.situp },
      { id: 'squatGroup', count: exercises.squat },
      { id: 'walkGroup', count: exercises.walk }
    ];
    
    groups.forEach(group => {
      if(group.count && group.count > 0) {
        const badge = document.createElement('span');
        badge.className = 'completed-badge';
        badge.textContent = `ì €ì¥ë¨: ${group.count}ì„¸íŠ¸`;
        const container = document.getElementById(group.id);
        const existing = container.querySelector('.completed-badge');
        if(existing) existing.remove();
        container.appendChild(badge);
      }
    });
  },

  createButtons() {
    this.createExerciseButtons('pushupButtons', 5);
    this.createExerciseButtons('situpButtons', 5);
    this.createExerciseButtons('squatButtons', 5);
    this.createExerciseButtons('walkButtons', 1);
  },

  createExerciseButtons(id, count) {
    const container = document.getElementById(id);
    container.innerHTML = '';
    
    for(let i = 1; i <= count; i++) {
      const btn = document.createElement('button');
      btn.className = 'exercise-btn';
      btn.type = 'button';
      btn.textContent = i + 'ì„¸íŠ¸';
      
      btn.addEventListener('click', () => { 
        // ì´ë¯¸ ì™„ë£Œëœ ì„¸íŠ¸ëŠ” í•´ì œ ê°€ëŠ¥
        if(btn.classList.contains('completed')) {
          btn.classList.remove('active', 'completed');
        } else {
          btn.classList.add('active');
        }
        this.updateScore(); 
        this.saveTempState(); // í´ë¦­ ì¦‰ì‹œ ì„ì‹œ ì €ì¥
      });
      
      container.appendChild(btn);
    }
  },

  getExerciseData() {
    return {
      pushup: document.querySelectorAll('#pushupButtons .active').length,
      situp: document.querySelectorAll('#situpButtons .active').length,
      squat: document.querySelectorAll('#squatButtons .active').length,
      walk: document.querySelectorAll('#walkButtons .active').length
    };
  },

  saveTempState() {
    // í˜„ì¬ ì²´í¬ëœ ìš´ë™ ìƒíƒœë¥¼ ì¦‰ì‹œ ì €ì¥
    const tempState = {
      exercises: this.getExerciseData(),
      note: document.getElementById('note').value,
      dateKey: this.todayKey,
      timestamp: Date.now()
    };
    
    try {
      localStorage.setItem('exerciseTempState', JSON.stringify(tempState));
      console.log('âœ… ì„ì‹œ ìƒíƒœ ìë™ ì €ì¥:', tempState.exercises);
    } catch(e) {
      console.error('ì„ì‹œ ì €ì¥ ì‹¤íŒ¨:', e);
    }
  },

  loadTempState() {
    // ì„ì‹œ ì €ì¥ëœ ìƒíƒœ ë³µì›
    try {
      const saved = localStorage.getItem('exerciseTempState');
      if(!saved) return;
      
      const tempState = JSON.parse(saved);
      
      // ì˜¤ëŠ˜ ë‚ ì§œì™€ ê°™ì€ ê²½ìš°ë§Œ ë³µì›
      if(tempState.dateKey === this.todayKey) {
        console.log('âœ… ì„ì‹œ ìƒíƒœ ë³µì›:', tempState.exercises);
        
        // ê° ìš´ë™ ë²„íŠ¼ ë³µì›
        const exercises = tempState.exercises;
        
        // íŒ”êµ½í˜€í´ê¸°
        for(let i = 1; i <= exercises.pushup; i++) {
          document.querySelector(`#pushupButtons .exercise-btn:nth-child(${i})`)?.classList.add('active');
        }
        
        // ìœ—ëª¸ì¼ìœ¼í‚¤ê¸°
        for(let i = 1; i <= exercises.situp; i++) {
          document.querySelector(`#situpButtons .exercise-btn:nth-child(${i})`)?.classList.add('active');
        }
        
        // ìŠ¤ì¿¼íŠ¸
        for(let i = 1; i <= exercises.squat; i++) {
          document.querySelector(`#squatButtons .exercise-btn:nth-child(${i})`)?.classList.add('active');
        }
        
        // ê±·ê¸°
        if(exercises.walk > 0) {
          document.querySelector('#walkButtons .exercise-btn')?.classList.add('active');
        }
        
        // ë©”ëª¨ ë³µì›
        if(tempState.note) {
          document.getElementById('note').value = tempState.note;
        }
        
        this.updateScore();
      } else {
        // ë‚ ì§œê°€ ë°”ë€Œì—ˆìœ¼ë©´ ì„ì‹œ ìƒíƒœ ì´ˆê¸°í™”
        localStorage.removeItem('exerciseTempState');
        console.log('ë‚ ì§œê°€ ë°”ë€Œì–´ ì„ì‹œ ìƒíƒœ ì´ˆê¸°í™”');
      }
    } catch(e) {
      console.error('ì„ì‹œ ìƒíƒœ ë³µì› ì‹¤íŒ¨:', e);
    }
  },

  calculateScore() {
    const data = this.getExerciseData();
    return Math.round(
      (data.pushup / 5) * 20 + 
      (data.situp / 5) * 24 + 
      (data.squat / 5) * 25 + 
      (data.walk / 1) * 31
    );
  },

  updateScore() { 
    const score = this.calculateScore();
    const data = this.getExerciseData();
    
    document.getElementById('scoreDisplay').textContent = score + 'ì ';
    document.getElementById('pushupScore').textContent = data.pushup;
    document.getElementById('situpScore').textContent = data.situp;
    document.getElementById('squatScore').textContent = data.squat;
    document.getElementById('walkScore').textContent = data.walk;
  },

  saveRecord() {
    const score = this.calculateScore();
    if(score === 0) { 
      this.showHint('1ì„¸íŠ¸ ì´ìƒ ì„ íƒí•˜ì„¸ìš”'); 
      return; 
    }
    
    const exercises = this.getExerciseData();
    const note = document.getElementById('note').value.trim();
    const now = new Date();
    
    // ì˜¤ëŠ˜ ê¸°ë¡ì´ ìˆìœ¼ë©´ ì—…ë°ì´íŠ¸, ì—†ìœ¼ë©´ ìƒˆë¡œ ì¶”ê°€
    const existingIndex = this.records.findIndex(r => r.dateKey === this.todayKey);
    
    const record = { 
      id: existingIndex >= 0 ? this.records[existingIndex].id : Date.now(),
      dateKey: this.todayKey,
      date: now.toLocaleDateString('ko-KR'), 
      time: now.toLocaleTimeString('ko-KR', {hour:'2-digit', minute:'2-digit'}), 
      score: score,
      exercises: exercises,
      note: note, 
      timestamp: now.getTime(),
      lastUpdated: now.getTime()
    };
    
    if(existingIndex >= 0) {
      this.records[existingIndex] = record;
      console.log('ì˜¤ëŠ˜ ê¸°ë¡ ì—…ë°ì´íŠ¸:', record);
      this.showHint(`âœ… ì˜¤ëŠ˜ ìš´ë™ ì—…ë°ì´íŠ¸! (${score}ì )`);
    } else {
      this.records.push(record);
      console.log('ìƒˆ ë‚ ì§œ ê¸°ë¡ ì¶”ê°€:', record);
      this.showHint(`âœ… ì˜¤ëŠ˜ ìš´ë™ ì €ì¥! (${score}ì )`);
    }
    
    this.todayData = record;
    
    // ì €ì¥ ì„±ê³µ ì—¬ë¶€ í™•ì¸
    if(this.saveData()) {
      // ì™„ë£Œëœ ë²„íŠ¼ í‘œì‹œ ì—…ë°ì´íŠ¸
      document.querySelectorAll('.exercise-btn.active').forEach(btn => {
        btn.classList.add('completed');
      });
      
      this.updateAllUI();
    } else {
      alert('âš ï¸ ì €ì¥ ì‹¤íŒ¨! Chrome ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.');
    }
  },

  resetToday() {
    if(!confirm('í˜„ì¬ ì²´í¬ëœ ìš´ë™ì„ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n(ì €ì¥ëœ ê¸°ë¡ì€ ìœ ì§€ë©ë‹ˆë‹¤)')) return;
    
    // ë²„íŠ¼ ì´ˆê¸°í™” (ì²´í¬ëœ ê²ƒë§Œ)
    document.querySelectorAll('.exercise-btn').forEach(btn => {
      btn.classList.remove('active');  // completedëŠ” ìœ ì§€ (ì´ë¯¸ ì €ì¥ëœ í‘œì‹œ)
    });
    
    // ë©”ëª¨ ì´ˆê¸°í™”
    document.getElementById('note').value = '';
    
    // ì„ì‹œ ìƒíƒœë§Œ ì œê±° (ì €ì¥ëœ ê¸°ë¡ì€ ìœ ì§€)
    localStorage.removeItem('exerciseTempState');
    
    // ì ìˆ˜ ì—…ë°ì´íŠ¸
    this.updateScore();
    this.showHint('ì²´í¬ëœ ìš´ë™ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤');
  },

  deleteRecord(id) {
    const record = this.records.find(r => r.id === id);
    const isToday = record && record.dateKey === this.todayKey;
    
    if(confirm(`${isToday ? 'ì˜¤ëŠ˜' : 'ì´ ë‚ ì§œ'}ì˜ ê¸°ë¡ì„ ì™„ì „íˆ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) {
      this.records = this.records.filter(r => r.id !== id);
      
      if(isToday) {
        // ì˜¤ëŠ˜ ê¸°ë¡ì´ë©´ ë²„íŠ¼ë„ ì´ˆê¸°í™”
        document.querySelectorAll('.exercise-btn').forEach(btn => {
          btn.classList.remove('active', 'completed');
        });
        document.getElementById('note').value = '';
        localStorage.removeItem('exerciseTempState');
        this.todayData = null;
      }
      
      this.saveData();
      this.updateAllUI();
      this.showHint('ê¸°ë¡ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤');
    }
  },

  updateAllUI() {
    this.updateScore();
    this.updateRecordList();
    this.updateChart();
    this.updateStats();
    this.showSavedExercises();
  },

  updateRecordList() {
    const list = document.getElementById('recordList');
    
    if(!this.records.length) { 
      list.innerHTML = '<div class="empty-state">ì•„ì§ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤ ğŸ’ª</div>'; 
      return; 
    }
    
    const sorted = this.records.slice().sort((a, b) => b.timestamp - a.timestamp);
    list.innerHTML = '';
    
    sorted.forEach(r => {
      const item = document.createElement('div'); 
      item.className = r.dateKey === this.todayKey ? 'record-item today' : 'record-item';
      
      const exercises = r.exercises || {};
      const exerciseText = [];
      if(exercises.pushup) exerciseText.push(`íŒ” ${exercises.pushup}`);
      if(exercises.situp) exerciseText.push(`ìœ—ëª¸ ${exercises.situp}`);
      if(exercises.squat) exerciseText.push(`ìŠ¤ì¿¼íŠ¸ ${exercises.squat}`);
      if(exercises.walk) exerciseText.push(`ê±·ê¸° ${exercises.walk}`);
      
      const left = document.createElement('div'); 
      left.style.flex = '1';
      left.innerHTML = `
        <strong style="display:block">${r.date} ${r.time} ${r.dateKey === this.todayKey ? '(ì˜¤ëŠ˜)' : ''}</strong>
        <div style="margin-top:4px; font-size:0.9rem; opacity:0.9">${exerciseText.join(', ')}</div>
        ${r.note ? `<div style="margin-top:4px; opacity:0.85">ğŸ“ ${this.escapeHtml(r.note)}</div>` : ''}
      `;
      
      const right = document.createElement('div'); 
      right.style.display = 'flex'; 
      right.style.alignItems = 'center'; 
      right.style.gap = '10px';
      right.innerHTML = `<strong style="font-size:1.1rem">${r.score}ì </strong>`;
      
      const del = document.createElement('button'); 
      del.className = 'delete-btn'; 
      del.type = 'button'; 
      del.textContent = 'ì‚­ì œ';
      del.addEventListener('click', () => this.deleteRecord(r.id));
      
      right.appendChild(del); 
      item.appendChild(left); 
      item.appendChild(right); 
      list.appendChild(item);
    });
  },

  updateChart() {
    const ctx = document.getElementById('scoreChart').getContext('2d');
    
    if(!this.records.length) { 
      if(this.chart) {
        this.chart.destroy(); 
        this.chart = null;
      } 
      return; 
    }
    
    const sorted = this.records.slice().sort((a, b) => a.timestamp - b.timestamp);
    const last30 = sorted.slice(-30); // ìµœê·¼ 30ì¼ë§Œ í‘œì‹œ
    
    const labels = last30.map(r => {
      const date = new Date(r.timestamp);
      return `${date.getMonth()+1}/${date.getDate()}`;
    });
    const data = last30.map(r => r.score);
    
    if(this.chart) this.chart.destroy();
    
    this.chart = new Chart(ctx, { 
      type: 'line', 
      data: {
        labels,
        datasets: [{
          label: 'ì ìˆ˜',
          data,
          borderColor: '#fbbf24',
          backgroundColor: 'rgba(251,191,36,0.18)',
          fill: true,
          borderWidth: 3,
          pointRadius: 5,
          tension: 0.25
        }]
      }, 
      options: {
        maintainAspectRatio: false,
        plugins: {
          legend: {labels: {font: {size: 12}}},
          tooltip: {mode: 'index', intersect: false}
        }, 
        scales: {
          x: {ticks: {font: {size: 11}, maxRotation: 45, minRotation: 0}, grid: {display: false}}, 
          y: {beginAtZero: true, max: 100, ticks: {font: {size: 12}}}
        }
      }
    });
  },

  updateStats() {
    const stats = document.getElementById('statsInfo');
    if(!this.records.length) {
      stats.style.display = 'none';
      return;
    }
    
    stats.style.display = 'block';
    const total = this.records.length;
    const avgScore = Math.round(this.records.reduce((sum, r) => sum + r.score, 0) / total);
    const maxScore = Math.max(...this.records.map(r => r.score));
    
    // ìµœê·¼ 7ì¼ í‰ê· 
    const week = new Date();
    week.setDate(week.getDate() - 7);
    const weekRecords = this.records.filter(r => r.timestamp > week.getTime());
    const weekAvg = weekRecords.length > 0 
      ? Math.round(weekRecords.reduce((sum, r) => sum + r.score, 0) / weekRecords.length)
      : 0;
    
    stats.innerHTML = `ğŸ“Š ì´ ${total}ì¼ ìš´ë™ | ì „ì²´í‰ê·  ${avgScore}ì  | 7ì¼í‰ê·  ${weekAvg}ì  | ìµœê³  ${maxScore}ì `;
  },

  attachEventListeners() {
    document.getElementById('saveBtn').addEventListener('click', () => this.saveRecord());
    document.getElementById('resetBtn').addEventListener('click', () => this.resetToday());
    
    // ë©”ëª¨ ì…ë ¥ ì‹œ ìë™ ì €ì¥
    document.getElementById('note').addEventListener('input', () => {
      this.saveTempState();
    });
    
    document.getElementById('note').addEventListener('keydown', e => { 
      if(e.ctrlKey && e.key === 'Enter') {
        e.preventDefault(); 
        this.saveRecord();
      }
    });
    
    document.getElementById('backupBtn').addEventListener('click', () => this.backupRecords());
    document.getElementById('restoreBtn').addEventListener('click', () => document.getElementById('restoreInput').click());
    document.getElementById('restoreInput').addEventListener('change', e => this.restoreRecords(e));
  },

  showHint(msg, duration = 2500) { 
    const s = document.getElementById('todayStatus'); 
    const orig = s.textContent; 
    s.textContent = msg; 
    s.style.background = '#10b981';
    clearTimeout(this._hintTimer); 
    this._hintTimer = setTimeout(() => {
      s.textContent = orig;
      s.style.background = '';
    }, duration); 
  },

  backupRecords() {
    if(!this.records.length) { 
      this.showHint('ì €ì¥ëœ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤'); 
      return; 
    }
    const today = new Date().toISOString().split('T')[0];
    const blob = new Blob([JSON.stringify(this.records, null, 2)], {type: 'application/json'});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); 
    a.href = url; 
    a.download = `exercise_backup_${today}.json`; 
    a.click();
    URL.revokeObjectURL(url);
    this.showHint(`${this.records.length}ê°œ ê¸°ë¡ ë°±ì—… ì™„ë£Œ`);
  },

  restoreRecords(e) {
    const file = e.target.files[0]; 
    if(!file) return;
    
    const reader = new FileReader();
    reader.onload = () => { 
      try { 
        const data = JSON.parse(reader.result); 
        if(Array.isArray(data)) { 
          const confirmMsg = this.records.length > 0 
            ? `í˜„ì¬ ${this.records.length}ê°œ ê¸°ë¡ì´ ìˆìŠµë‹ˆë‹¤. ë°±ì—… íŒŒì¼(${data.length}ê°œ)ë¡œ êµì²´í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`
            : `${data.length}ê°œ ê¸°ë¡ì„ ë¶ˆëŸ¬ì˜¤ì‹œê² ìŠµë‹ˆê¹Œ?`;
          
          if(confirm(confirmMsg)) {
            this.records = data; 
            this.saveData(); 
            this.loadTodayData();
            this.updateAllUI();
            this.showHint(`${data.length}ê°œ ê¸°ë¡ ë³µì› ì™„ë£Œ!`); 
          }
        } else { 
          this.showHint('ì˜¬ë°”ë¥¸ ë°±ì—… íŒŒì¼ì´ ì•„ë‹™ë‹ˆë‹¤'); 
        } 
      } catch(err) { 
        console.error('ë³µì› ì‹¤íŒ¨:', err);
        this.showHint('íŒŒì¼ ì½ê¸° ì‹¤íŒ¨'); 
      } 
    };
    reader.readAsText(file); 
    e.target.value = '';
  },

  escapeHtml(str) { 
    return str.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); 
  }
};

// ì•± ì‹œì‘
document.addEventListener('DOMContentLoaded', () => exerciseApp.init());

// Chrome ëª¨ë°”ì¼ ì €ì¥ ë¬¸ì œ í•´ê²° ì•ˆë‚´
if(/Android/i.test(navigator.userAgent)) {
  console.log('ğŸ“± Android Chrome ê°ì§€ë¨');
}
</script>
</body>
</html>
